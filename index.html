<script>
async function fetchWeatherAlerts() { 
    const apiUrl = "https://api.weather.gov/alerts/active"; 
    try { 
        const response = await fetch(apiUrl); 
        const data = await response.json(); 

        // Filter for specific alerts only
        const filteredAlerts = data.features.filter(alert => 
            alert.properties.event.includes("Tornado Emergency") || 
            alert.properties.event.includes("Flash Flood Emergency") ||
            alert.properties.event.includes("Tornado Warning") || 
            alert.properties.event.includes("Flash Flood Warning") || 
            alert.properties.event.includes("Severe Thunderstorm Warning")
        );

        // Sort by priority: Tornado Emergency > Flash Flood Emergency > Tornado Warning > Flash Flood Warning > Severe Thunderstorm Warning
        const priorityOrder = {
            "Tornado Emergency": 1,
            "Flash Flood Emergency": 2,
            "Tornado Warning": 3,
            "Flash Flood Warning": 4,
            "Severe Thunderstorm Warning": 5
        };

        filteredAlerts.sort((a, b) => {
            return (priorityOrder[a.properties.event] || 99) - (priorityOrder[b.properties.event] || 99);
        });

        // Format alerts to show only warning type and affected counties
        const alertsText = filteredAlerts.map(alert => {
            const eventType = alert.properties.event; // "Tornado Warning", "Severe Thunderstorm Warning", etc.
            const affectedAreas = alert.properties.areaDesc; // List of counties
            return `${eventType}: ${affectedAreas}`;
        });

        updateTicker(alertsText);
    } catch (error) {
        console.error("Error fetching weather alerts:", error);
    }
}

function updateTicker(alerts) {
    const tickerElement = document.getElementById("ticker");
    tickerElement.innerHTML = ""; // Clear previous alerts

    alerts.forEach(alert => {
        const alertElement = document.createElement("span");
        alertElement.classList.add("alert");

        // Assign colors based on priority
        if (alert.includes("Tornado Emergency")) {
            alertElement.classList.add("tornado-emergency");
        } else if (alert.includes("Tornado Warning")) {
            alertElement.classList.add("tornado-warning");
        } else if (alert.includes("Flash Flood Emergency")) {
            alertElement.classList.add("flash-flood-emergency");
        } else if (alert.includes("Flash Flood Warning")) {
            alertElement.classList.add("flash-flood-warning");
        } else if (alert.includes("Severe Thunderstorm Warning")) {
            alertElement.classList.add("severe-thunderstorm");
        }

        alertElement.textContent = alert;
        tickerElement.appendChild(alertElement);
    });
}

// Refresh alerts every 60 seconds
setInterval(fetchWeatherAlerts, 60000);
fetchWeatherAlerts();
</script>
